<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Analisa 3D/4D - Mahasewa</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #eee; padding: 20px; text-align: center; }
        .menu-tombol { margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 5px; background: #333; color: white; font-weight: bold; transition: 0.3s; }
        button:hover { background: #555; }
        button.active { background: #d9534f; box-shadow: 0 0 10px rgba(217, 83, 79, 0.5); }
        .btn-gen { background: #f0ad4e; color: #000; margin-top: 10px; font-size: 0.9em; }
        .btn-gen:disabled { background: #555; color: #888; cursor: not-allowed; }

        .main-layout { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 30px; }
        .card { background: #222; padding: 15px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); width: 100%; max-width: 450px; }
        
        .grid-2d { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; max-height: 250px; overflow-y: auto; padding: 10px; background: #111; border-radius: 5px; }
        .item-2d { background: #333; padding: 5px; border-radius: 3px; font-size: 1.1em; font-weight: bold; }
        .item-belum { color: #5cb85c; }

        .accordion { background: #333; color: #fff; cursor: pointer; padding: 15px; width: 100%; border: none; text-align: left; font-size: 1.1em; margin-top: 10px; border-radius: 5px; display: flex; justify-content: space-between; font-weight: bold; }
        .panel { padding: 0 18px; display: none; background-color: #1a1a1a; border: 1px solid #333; border-radius: 0 0 5px 5px; margin-bottom: 10px; }
        
        pre { background: #000; color: #0f0; padding: 15px; border-radius: 5px; text-align: left; font-family: 'Courier New', Courier, monospace; line-height: 1.5; border: 1px solid #444; }
        .badge { background: #d9534f; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
        h4 { margin-bottom: 5px; color: #f0ad4e; }
    </style>
</head>
<body>

    <h1>MESIN BBFS MAHASEWA</h1>

    <div class="menu-tombol">
        <button onclick="pilihPasaran('hk', this)">HONGKONG</button>
        <button onclick="pilihPasaran('sdy', this)">SYDNEY</button>
        <button onclick="pilihPasaran('sgp', this)">SINGAPORE</button>
    </div>

    <div class="main-layout">
        <div class="card">
            <h2 id="judul-sudah">Data Keluar</h2>
            <div id="display-sudah" class="grid-2d">Pilih pasaran</div>
        </div>
        <div class="card">
            <h2 id="judul-belum" style="color:#5cb85c">2D Hijau (Ekor)</h2>
            <div id="display-belum" class="grid-2d">Pilih pasaran</div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button id="btn3d" class="btn-gen" onclick="generate3D()" disabled>Pasangkan 3D</button>
                <button id="btn4d" class="btn-gen" onclick="generate4D()" disabled>Pasangkan 4D</button>
            </div>
        </div>
    </div>

    <div id="hasil-container" style="max-width: 920px; margin: 0 auto; text-align: left;">
        <button class="accordion">HASIL ACAK <span id="count-acak" class="badge">0 Line</span></button>
        <div class="panel" id="panel-acak"></div>

        <button class="accordion">HASIL TWIN <span id="count-twin" class="badge">0 Line</span></button>
        <div class="panel" id="panel-twin"></div>
    </div>

    <script>
        const username = "Mahasewa";
        const repo = "mesin-bbfs";
        let dataHijau = [];
        let dataHistory = [];

        async function pilihPasaran(pasaran, btn) {
            document.querySelectorAll('.menu-tombol button').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');

            try {
                const response = await fetch(`https://raw.githubusercontent.com/${username}/${repo}/main/data_keluaran_${pasaran}.txt`);
                const text = await response.text();
                dataHistory = text.trim().split("\n").map(l => l.trim());
                
                const last100 = [...dataHistory].slice(-100).reverse();
                let sudahArr = last100.map(a => a.slice(-2));
                
                dataHijau = [];
                let hSudah = "";
                last100.forEach(a => hSudah += `<div class="item-2d">${a.slice(-2)}</div>`);
                
                let hBelum = "";
                for(let i=0; i<=99; i++){
                    let n = i.toString().padStart(2, '0');
                    if(!sudahArr.includes(n)) {
                        dataHijau.push(n);
                        hBelum += `<div class="item-2d item-belum">${n}</div>`;
                    }
                }

                document.getElementById('display-sudah').innerHTML = hSudah;
                document.getElementById('display-belum').innerHTML = hBelum;
                document.getElementById('btn3d').disabled = false;
                document.getElementById('btn4d').disabled = false;
                document.getElementById('judul-belum').innerText = `2D Hijau (${dataHijau.length})`;
            } catch (e) { alert("Gagal ambil data!"); }
        }

        function generate3D() { prosesGenerate(3); }
        function generate4D() { prosesGenerate(4); }

        function prosesGenerate(mode) {
            let acak = [];
            let twin = [];

            dataHijau.forEach(ekor => {
                let limit = (mode === 4) ? 99 : 9;
                for (let i = 0; i <= limit; i++) {
                    let depan = (mode === 4) ? i.toString().padStart(2, '0') : i.toString();
                    let gabung = depan + ekor;
                    
                    // Filter Quad/Triple (Max 2 digit sama)
                    let counts = {};
                    for(let char of gabung) counts[char] = (counts[char] || 0) + 1;
                    if (Math.max(...Object.values(counts)) >= 3) continue;

                    // Filter Seri Depan-Belakang (Jika ekor kembar, depan dilarang sama)
                    if (ekor[0] === ekor[1] && depan.endsWith(ekor[0])) continue;

                    // Filter Riwayat (Dilarang ada di database)
                    if (dataHistory.some(h => h.endsWith(gabung))) continue;

                    let unik = new Set(gabung).size;
                    if (unik === mode) acak.push(gabung);
                    else twin.push(gabung);
                }
            });

            tampilkanHasil(acak, 'panel-acak', 'count-acak');
            tampilkanHasil(twin, 'panel-twin', 'count-twin');
            alert("Hasil " + mode + "D Berhasil Dibuat!");
        }

        function tampilkanHasil(array, panelId, countId) {
            const panel = document.getElementById(panelId);
            document.getElementById(countId).innerText = array.length + " Line";
            panel.innerHTML = "";
            
            for (let i = 0; i < array.length; i += 300) {
                let chunk = array.slice(i, i + 300).join(" *\n"); // Pakai bintang dan Baris Baru
                panel.innerHTML += `<h4>Blok ${Math.floor(i/300)+1}</h4><pre>${chunk} *</pre>`;
            }
        }

        var acc = document.getElementsByClassName("accordion");
        for (var i = 0; i < acc.length; i++) {
            acc[i].onclick = function() {
                this.classList.toggle("active-acc");
                var p = this.nextElementSibling;
                p.style.display = (p.style.display === "block") ? "none" : "block";
            };
        }
    </script>
</body>
</html>
